<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <!-- Include the CesiumJS JavaScript and CSS files -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.119/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.119/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
</head>

<style>
  .app .data .map {
    position: relative;
  }

  html,
  body,
  #cesiumContainer,
  .leaflet-container {
    position: absolute;
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
  }
</style>

<body>
  <div id="cesiumContainer"></div>
  <script>
    // Set the Cesium Ion token to `null` to avoid warnings
    Cesium.Ion.defaultAccessToken = null;

    /* Per Carto's website regarding basemap attribution: https://carto.com/help/working-with-data/attribution/#basemaps */
    let CartoAttribution = 'Map tiles by <a href="https://carto.com">Carto</a>, under CC BY 3.0. Data by <a href="https://www.openstreetmap.org/">OpenStreetMap</a>, under ODbL.'

    // Create ProviderViewModel based on different imagery sources
    // - these can be used without Cesium Ion
    var imageryViewModels = [];

    imageryViewModels.push(new Cesium.ProviderViewModel({
      name: 'OpenStreetMap',
      iconUrl: Cesium.buildModuleUrl('Widgets/Images/ImageryProviders/openStreetMap.png'),
      tooltip: 'OpenStreetMap (OSM) is a collaborative project to create a free editable \
    map of the world.\nhttp://www.openstreetmap.org',
      creationFunction: function () {
        return new Cesium.UrlTemplateImageryProvider({
          url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
          subdomains: 'abc',
          minimumLevel: 0,
          maximumLevel: 19
        });
      }
    }));
    imageryViewModels.push(new Cesium.ProviderViewModel({
      name: 'Positron',
      tooltip: 'CartoDB Positron basemap',
      iconUrl: 'http://a.basemaps.cartocdn.com/light_all/5/15/12.png',
      creationFunction: function () {
        return new Cesium.UrlTemplateImageryProvider({
          url: 'http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png',
          credit: CartoAttribution,
          minimumLevel: 0,
          maximumLevel: 18
        });
      }
    }));
    imageryViewModels.push(new Cesium.ProviderViewModel({
      name: 'Positron without labels',
      tooltip: 'CartoDB Positron without labels basemap',
      iconUrl: 'http://a.basemaps.cartocdn.com/rastertiles/light_nolabels/5/15/12.png',
      creationFunction: function () {
        return new Cesium.UrlTemplateImageryProvider({
          url: 'https://{s}.basemaps.cartocdn.com/rastertiles/light_nolabels/{z}/{x}/{y}.png',
          credit: CartoAttribution,
          minimumLevel: 0,
          maximumLevel: 18
        });
      }
    }));
    imageryViewModels.push(new Cesium.ProviderViewModel({
      name: 'Dark Matter',
      tooltip: 'CartoDB Dark Matter basemap',
      iconUrl: 'http://a.basemaps.cartocdn.com/rastertiles/dark_all/5/15/12.png',
      creationFunction: function () {
        return new Cesium.UrlTemplateImageryProvider({
          url: 'https://{s}.basemaps.cartocdn.com/rastertiles/dark_all/{z}/{x}/{y}.png',
          credit: CartoAttribution,
          minimumLevel: 0,
          maximumLevel: 18
        });
      }
    }));
    imageryViewModels.push(new Cesium.ProviderViewModel({
      name: 'Dark Matter without labels',
      tooltip: 'CartoDB Dark Matter without labels basemap',
      iconUrl: 'http://a.basemaps.cartocdn.com/rastertiles/dark_nolabels/5/15/12.png',
      creationFunction: function () {
        return new Cesium.UrlTemplateImageryProvider({
          url: 'https://{s}.basemaps.cartocdn.com/rastertiles/dark_nolabels/{z}/{x}/{y}.png',
          credit: CartoAttribution,
          minimumLevel: 0,
          maximumLevel: 18
        });
      }
    }));
    imageryViewModels.push(new Cesium.ProviderViewModel({
      name: 'Voyager',
      tooltip: 'CartoDB Voyager basemap',
      iconUrl: 'http://a.basemaps.cartocdn.com/rastertiles/voyager_labels_under/5/15/12.png',
      creationFunction: function () {
        return new Cesium.UrlTemplateImageryProvider({
          url: 'https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}.png',
          credit: CartoAttribution,
          minimumLevel: 0,
          maximumLevel: 18
        });
      }
    }));
    imageryViewModels.push(new Cesium.ProviderViewModel({
      name: 'Voyager without labels',
      tooltip: 'CartoDB Voyager without labels basemap',
      iconUrl: 'http://a.basemaps.cartocdn.com/rastertiles/voyager_nolabels/5/15/12.png',
      creationFunction: function () {
        return new Cesium.UrlTemplateImageryProvider({
          url: 'https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}.png',
          credit: CartoAttribution,
          minimumLevel: 0,
          maximumLevel: 18
        });
      }
    }));
    imageryViewModels.push(new Cesium.ProviderViewModel({
      name: 'National Map Satellite',
      iconUrl: 'https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryOnly/MapServer/tile/4/6/4',
      creationFunction: function () {
        return new Cesium.UrlTemplateImageryProvider({
          url: 'https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryOnly/MapServer/tile/{z}/{y}/{x}',
          credit: 'Tile data from <a href="https://basemap.nationalmap.gov/">USGS</a>',
          minimumLevel: 0,
          maximumLevel: 16
        });
      }
    }));

    // Initialize the viewer - this works without a token!
    viewer = new Cesium.Viewer('cesiumContainer', {
      imageryProviderViewModels: imageryViewModels,
      selectedImageryProviderViewModel: imageryViewModels[1],
      animation: true,
      timeline: true,
      infoBox: false,
      homeButton: false,
      fullscreenButton: false,
      selectionIndicator: true,
    });
    // Remove the Terrain section of the baseLayerPicker
    viewer.baseLayerPicker.viewModel.terrainProviderViewModels.removeAll()
    var carIconUrl = 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="52" height="52" viewBox="0 0 16 16"><text x="0" y="14">ðŸš—</text></svg>');
    viewer.dataSources
      .add(
        Cesium.GpxDataSource.load(
          "./loc.gpx",
          {
            clampToGround: true,
          }
        )
      )
      .then(function (dataSource) {

        var entities = dataSource.entities.values;
        for (var i = 0; i < entities.length; i++) {
          var entity = entities[i];
          if (entity.position) {
            entity.billboard = new Cesium.BillboardGraphics({
              image: carIconUrl,
              width: 35, // Width in pixels
              height: 35, // Height in pixels
              verticalOrigin: Cesium.VerticalOrigin.BOTTOM
            });
            // Remove the point if it exists
            entity.point = undefined;
          }
        }
        viewer.zoomTo(dataSource.entities);
      });

    viewer.clock.clockRange = Cesium.ClockRange.UNBOUNDED;
    viewer.clock.clockStep = Cesium.ClockStep.SYSTEM_CLOCK;

  </script>
  </div>
</body>

</html>